<!DOCTYPE html>
<html lang="pt-br">
<head>
  <%- include('../shared/head'); %>
</head>
<body class="vh-100 vw-100 p-4" style="background: #6610f2">

  <%- include('../shared/navbar', {user: user}); %>

  <main class="container bg-body rounded p-4">

    <div class="d-flex align-items-center justify-content-between">
      <h1>Cadastrar nova venda</h1>
      
      <%- include('../shared/back_link'); %>
      
    </div>

    <div class="d-flex align-items-start justify-content-between">
      <div>
        <div>
          <label for="nomeClienteInput" class="form-label">Cliente</label>
          <div class="input-group mb-3">
            <input id="nomeClienteInput" type="text" class="form-control" placeholder="Nome do cliente" aria-label="Nome do cliente" aria-describedby="btnCliente">
            <button class="btn btn-outline-primary" type="button" id="btnCliente">Adicionar</button>
          </div>
        </div>
        <div class="mb-3">
          <label for="dataVendaInput" class="form-label">Data da venda</label>
          <input type="date" class="form-control" id="dataVendaInput">
        </div>
        <div>
          <label for="inputGroupSelectProdutos" class="form-label">Produtos</label>
          <div class="input-group">
            <select class="form-select" id="inputGroupSelectProdutos" aria-label="Selecione um produto">
              <option selected>Choose...</option>
              <option value="1">One</option>
              <option value="2">Two</option>
              <option value="3">Three</option>
            </select>
            <button class="btn btn-outline-primary" type="button" id="btnProdutos">Adicionar</button>
          </div>
        </div>
        <div class="mt-2">
          <ul class="list-group">
            <li class="list-group-item active d-flex align-items-start justify-content-between" aria-current="true">
              <p class="mb-0">Produto</p>
              <p class="mb-0">Quantidade</p>
            </li>
            <li class="list-group-item d-flex align-items-start justify-content-between" aria-current="true">
              <p class="mb-0">One</p>
              <p class="mb-0">
                <button class="btn btn-light" type="button">-</button>
                10
                <button class="btn btn-light" type="button">+</button>
              </p>
            </li>
            <li class="list-group-item d-flex align-items-start justify-content-between" aria-current="true">
              <p class="mb-0">One</p>
              <p class="mb-0">
                <button class="btn btn-light" type="button">-</button>
                10
                <button class="btn btn-light" type="button">+</button>
              </p>
            </li>
          </ul>
        </div>
        <div>
          <label for="descontoInput" class="form-label">Desconto</label>
          <div class="input-group mb-3">
            <input id="descontoInput" type="text" class="form-control" placeholder="Desconto" aria-label="Desconto" aria-describedby="btnDesconto">
            <button class="btn btn-outline-primary" type="button" id="btnDesconto">Adicionar</button>
          </div>
        </div>
        
      </div>
      <div class="card text-bg-secondary mb-3">
        <div class="card-header text-center">
          <h3>Resumo da venda</h3>
        </div>
        <div class="card-body">
          <div class="d-flex column-gap-2 m-0">
            <p class="fw-semibold m-0"">Cliente:</p> <p class="mb-0" id="displayCliente"></p> 
          </div>
          <div class="d-flex column-gap-2 m-0">
            <p class="fw-semibold m-0"">Data:</p> <p id="displayData"></p> 
          </div>
          
          <hr class="border border-light m-0">

          <h5 class="card-title mt-4">Itens da venda</h5>
          
          <table class="table table-secondary">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">Produto</th>
                <th scope="col">Quantidade</th>
                <th scope="col">Valor total</th>
              </tr>
            </thead>
            <tbody>

                <tr>
                 <th scope="row">1</th>
                 <td scope="row">Teste></td>
                 <td scope="row"> 1</td> 
                 <td scope="row">R$100,00</td>
                </tr>

                <tr>
                  <th scope="row">1</th>
                  <td>Teste></td>
                  <td>1</td> 
                  <td>R$100,00</td>
                 </tr>
                
            </tbody>
          </table>      


          <hr class="border border-light m-0 mb-2">
          <div class="d-flex justify-content-between column-gap-2 m-0">
            <p class="fw-light fs-6 mb-0">Valor total:</p> <p class="mb-0">R$100,00</p> 
          </div>
          <div class="d-flex justify-content-between column-gap-2 m-0">
            <p class="fw-light fs-6 mb-0">Desconto:</p> <p class="mb-0">R$10,00</p> 
          </div>
          <div class="d-flex justify-content-between column-gap-2 m-0">
            <p class="fw-light fs-6 mb-0">Valor pago:</p> <p class="mb-0">R$90,00</p> 
          </div>

          <div class="d-grid gap-2 mt-2">
            <button class="btn btn-primary" type="button">Cadastrar</button>
          </div>
        </div>
      </div>

    </div> 
  </main>

<%- include('../shared/footer'); %>
<script>
  const $ = (id) => document.getElementById(id)
  let clientes = []
  let produtos = []

  // carrega quando a tela fica pronta
  document.addEventListener("readystatechange", function(){
    const baseUrl = window.location.href.replace('/vendas/cadastro', '/api')
    const userId = document.cookie.split(';').find(c => c.includes('Authorization')).split('=')[1]
    fetch(baseUrl + '/clientes', { headers:{ 'Authentication':  userId }})
      .then((response) => response.json().then(data => {
        clientes = data
        console.log('clientes', data)
      }))
      .catch((err) => console.log(err))
    fetch(baseUrl + '/produto', { headers:{ 'Authentication':  userId }})
      .then((response) => response.json().then(data => {
        produtos = data
        console.log('produto', data)
      }))
      .catch((err) => console.log(err))
  });
  
  // constroi resumo do pedido
  $('btnCliente').addEventListener('click', (ev) => {
    $('displayCliente').innerHTML = $('nomeClienteInput').value
  })

  $('dataVendaInput').addEventListener('change', () => {
    const valor = $('dataVendaInput').value;
    let objectDate = new Date(valor);
    let day = objectDate.getDate();
    let month = objectDate.getMonth() + 1;
    let year = objectDate.getFullYear();
    $('displayData').innerHTML = `${day}/${month}/${year}`
  })
</script>
</body>
</html>